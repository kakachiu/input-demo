<!DOCTYPE html>
<html lang="zh-tw">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>input demo</title>
  </head>

  <style>
    .picContent {
      width: 400px;
      display: flex;
    }
    img {
      width: 100%;
    }
  </style>

  <body>
    <input
      type="file"
      class="selectFile"
      accept="image/*"
      multiple="multiple"
    />
    <div class="picContent" id="groupTu"></div>

    <script type="text/javascript">
      const selectFile = document.querySelector(".selectFile");

      // 上傳多個文件方法
      // input file 增加 multiple 屬性，按住 ctrl 可多選
      selectFile.addEventListener("change", function () {
        // 由於還要加拍照的，所以可以監聽長度如果大於9張就把選擇檔案按鈕灰底
        // 限制選擇張數
        var fileLength = document.querySelector(".selectFile").files.length;
        console.log(fileLength);
        if (fileLength > 9) {
          alert(
            "最多僅支援9張相片，你選擇了" + fileLength + "張，請重新選擇！"
          );
          selectFile.value = "";
          return false;
        }

        var obj = this,
          length = obj.files.length,
          arrTitle = []; // 存標題名
        _html = "";

        for (var i = 0; i < length; i++) {
          var reader = new FileReader();
          if (!reader) {
            console.log("您的瀏覽器不支援！請使用 chrome 瀏覽器");
            return;
          }
          // 儲存上傳的多張圖片名稱
          arrTitle.push(obj.files[i].name);

          reader.error = function (e) {
            console.log("讀取異常");
          };

          // IIFE 语法
          (function (i) {
            // 讀取成功
            reader.onload = function (e) {
              // console.log(e)
              var _src = e.target.result;

              // 節點
              var divItem = document.createElement("div");
              divItem.setAttribute("class", "item");
              var divPic = document.createElement("div");
              divPic.setAttribute("class", "pic-box");
              var img = document.createElement("img");
              img.setAttribute("class", "img");
              img.setAttribute("src", _src);
              var divTk = document.createElement("div");
              divTk.setAttribute("class", "tk");
              var spanDel = document.createElement("span");
              spanDel.setAttribute("class", "del");
              spanDel.setAttribute("title", arrTitle[i]);
              spanDel.innerText = "x";

              divTk.innerHTML = arrTitle[i];

              divItem.appendChild(divPic);
              divPic.appendChild(img);
              divItem.appendChild(divTk);
              divItem.appendChild(spanDel);

              // 增加節點結構
              var groupTu = document.getElementById("groupTu");
              groupTu.insertBefore(divItem, groupTu.firstChild);

              // 刪除節點
              spanDel.onclick = function () {
                removeItem(this);
                return false;
              };

              selectFile.value = "";
            };
          })(i);

          reader.οnlοadstart = function () {};
          reader.οnprοgress = function (e) {
            if (e.lengthComputable) {
              console.log("正在讀取文件");
            }
          };
          reader.readAsDataURL(obj.files[i]);
        }
      });

      // 刪除圖片
      function removeItem(delNode) {
        var itemNode = delNode.parentNode,
          title = delNode.getAttribute("title");
        var flag = confirm("確認要刪除：" + title + "圖片？");
        if (flag) {
          itemNode.parentNode.removeChild(itemNode);
          console.log("刪除成功");
        }
        return false;
      }
    </script>
  </body>
</html>
